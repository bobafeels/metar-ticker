<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live METAR Ticker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: black;
      color: #00ff99;
      font-family: Arial, sans-serif;
      font-size: 28px;
    }

    #ticker-wrapper {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      line-height: 60px;
      overflow: hidden;
      white-space: nowrap;
      background: black;
    }

    .ticker {
      display: inline-block;
      padding-left: 100%;
      will-change: transform;
      animation: scroll 25s linear infinite;
    }

    @keyframes scroll {
      from {
        transform: translateX(0%);
      }
      to {
        transform: translateX(-100%);
      }
    }
  </style>
</head>
<body>

<div id="ticker-wrapper">
  <div class="ticker" id="ticker">Loading METAR…</div>
</div>

<script>
  // CHANGE THIS TO YOUR AIRPORT ICAO, e.g. "KDEN", "KLEX"
  const station = "KAMW";

  async function fetchMETAR() {
    const tickerEl = document.getElementById("ticker");

    try {
      const url = `https://api.weather.gov/stations/${station}/observations/latest`;

      const response = await fetch(url, {
        mode: "cors",
        headers: {
          "Accept": "application/geo+json"
        }
      });

      if (!response.ok) {
        throw new Error("HTTP " + response.status);
      }

      const data = await response.json();
      const props = (data && data.properties) ? data.properties : {};

      const raw = props.rawMessage || `No raw METAR available for ${station}`;

      const windSpeedMs   = props.windSpeed && props.windSpeed.value;
      const windDir       = props.windDirection && props.windDirection.value;
      const visMeters     = props.visibility && props.visibility.value;
      const tempC         = props.temperature && props.temperature.value;
      const pressurePa    = props.barometricPressure && props.barometricPressure.value;
      const timestamp     = props.timestamp;

      const windKts = (windSpeedMs != null)
        ? (windSpeedMs * 1.94384).toFixed(0)
        : "N/A";
      const windDirDeg = (windDir != null)
        ? windDir.toFixed(0)
        : "VRB";
      const visSm = (visMeters != null)
        ? (visMeters / 1609.34).toFixed(1)
        : "N/A";
      const tempStr = (tempC != null)
        ? tempC.toFixed(1) + " °C"
        : "N/A";
      const altInHg = (pressurePa != null)
        ? (pressurePa / 3386.39).toFixed(2)
        : "N/A";

      const timeStr = timestamp
        ? new Date(timestamp).toUTCString()
        : "";

      const formatted =
        `${station} | ${raw} ` +
        `| Wind: ${windDirDeg}° @ ${windKts} kt ` +
        `| Vis: ${visSm} SM ` +
        `| Temp: ${tempStr} ` +
        `| Alt: ${altInHg} inHg ` +
        (timeStr ? `| Obs: ${timeStr}` : "");

      tickerEl.textContent = formatted;

    } catch (err) {
      console.error("Error loading METAR:", err);
      tickerEl.textContent = "Error loading METAR: " + err.message;
    }
  }

  // Initial load + periodic refresh
  fetchMETAR();
  setInterval(fetchMETAR, 60000);
</script>

</body>
</html>
